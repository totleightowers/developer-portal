# Notify Developer Portal
#
# Add this workflow to any source repo that publishes documentation
# to the Ministry of Magic Developer Portal. When docs change on the default branch,
# it fires a repository_dispatch event to trigger re-ingestion.
#
# Requirements:
#   - A fine-grained PAT with `contents: write` on the portal repo,
#     stored as a secret named PORTAL_DISPATCH_TOKEN.

name: Notify Developer Portal

on:
  push:
    branches: [main]
    paths:
      - "source/documentation/**"

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger portal ingestion
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.PORTAL_DISPATCH_TOKEN }}
          repository: totleightowers/developer-portal
          event-type: docs-update
          client-payload: '{"source_id": "${{ github.event.repository.name }}"}'
