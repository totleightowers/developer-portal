# Ministry of Magic Developer Portal

A cross-government developer portal inspired by [Singapore's Government Developer Portal](https://developer.tech.gov.sg/), built with GOV.UK styles.

**Status:** Alpha — this is a proof of concept.

## What it does

- **Product catalogue** — browse platforms, tools, and APIs available across government (mix of real MoJ platforms and whimsical Ministry of Magic services)
- **Documentation hub** — technical docs ingested automatically from source repositories (Cloud Platform, Modernisation Platform, Analytical Platform)
- **Guidelines** — standards and best practices organised by project lifecycle phase, linking out to real cross-government resources (Service Standard, Technology Code of Practice, NCSC guidance, MoJ AI Governance Framework, GOV.UK Design System, and more)
- **Community** — links to Slack channels, open source, events
- **AI chatbot** — contextual help assistant (mock responses in alpha)
- **Full-text search** — powered by [Pagefind](https://pagefind.app/)

## Tech stack

| Component | Technology |
|---|---|
| Framework | [Next.js 16](https://nextjs.org/) (App Router, static export) |
| Styles | [GOV.UK Frontend](https://frontend.design-system.service.gov.uk/) v6 + Sass |
| Content | Markdown with YAML frontmatter |
| Search | [Pagefind](https://pagefind.app/) (client-side, zero-dependency) |
| Ingestion | Node.js script that clones repos and converts `.html.md.erb` → `.md` |
| Hosting | GitHub Pages (static), containerisable for Cloud Platform |

## Getting started

### Prerequisites

- Node.js 22+
- npm

### Run locally

```bash
# Install dependencies
npm install

# Start the dev server
npm run dev
```

Open [http://localhost:3000](http://localhost:3000).

### Ingest real documentation

The portal can pull documentation from external GitHub repositories:

```bash
# Ingest all enabled sources (clones repos, converts docs)
npm run ingest

# Preview what would be ingested without writing files
npm run ingest:dry-run

# Ingest a specific source only
node scripts/ingest.mjs cloud-platform

# Ingest and then build
npm run ingest:build
```

Source repos are configured in [`sources.json`](sources.json).

### Build for production

```bash
npm run build
```

This runs `next build` followed by Pagefind indexing. Output is in `out/`.

## Content structure

```
content/
├── docs/                    # Documentation (auto-generated by ingestion)
│   ├── cloud-platform/
│   │   ├── _meta.json       # Source metadata
│   │   ├── index.md
│   │   ├── getting-started/
│   │   └── ...
│   ├── modernisation-platform/
│   └── analytical-platform/
├── products/
│   └── products.json        # Product catalogue data
└── guidelines/
    └── guidelines.json      # Guidelines data (internal + external links)
```

### Guidelines: internal vs external

Guidelines in `guidelines.json` can be either internal (rendered as portal pages) or external (linked out to the canonical source). An entry with an `externalUrl` field links directly — no internal page is generated.

Current external links:

| Phase | Resource | Source |
|---|---|---|
| Inception | [GOV.UK Service Manual](https://www.gov.uk/service-manual) | GDS |
| Inception | [Service Standard](https://www.gov.uk/service-manual/service-standard) | GDS |
| Development | [GDS API Technical & Data Standards](https://www.gov.uk/guidance/gds-api-technical-and-data-standards) | GDS |
| Development | [NCSC Secure Development & Deployment](https://www.ncsc.gov.uk/collection/developers-collection) | NCSC |
| Technology | [Technology Code of Practice](https://www.gov.uk/guidance/the-technology-code-of-practice) | CDDO |
| Technology | [GOV.UK Design System](https://design-system.service.gov.uk/) | GDS |
| Standards | [MoJ AI Governance Framework](https://technical-guidance.service.justice.gov.uk/documentation/governance/ai-governance-framework.html#introduction) | MoJ |
| Standards | [NCSC Cloud Security Guidance](https://www.ncsc.gov.uk/collection/cloud-security) | NCSC |
| Measuring | [Measuring service performance](https://www.gov.uk/service-manual/measuring-success) | GDS |

## Ingestion pipeline

The ingestion pipeline (`scripts/ingest.mjs`) does the following:

1. Reads [`sources.json`](sources.json) for the list of doc repositories
2. Shallow-clones each repo (cached in `.ingestion-cache/`)
3. Discovers doc files (`.html.md.erb` and `.md`) under the configured `docsPath`
4. Strips ERB tags and converts tech-docs-template patterns
5. Enriches frontmatter with `source_repo`, `source_path`, and `ingested_at`
6. Writes converted `.md` files to `content/docs/<source-id>/`

### Adding a new doc source

1. Add an entry to `sources.json`
2. Run `npm run ingest:dry-run` to verify discovery
3. Run `npm run ingest` to pull the docs
4. The site will automatically include the new source on next build

### Webhook-driven updates

Source repos can trigger re-ingestion automatically using `repository_dispatch`. See [`.github/workflows/notify-portal.yml.example`](.github/workflows/notify-portal.yml.example) for a workflow to add to source repos.

## GitHub Actions

| Workflow | Trigger | Purpose |
|---|---|---|
| [`deploy.yml`](.github/workflows/deploy.yml) | Push to main, schedule (6h), manual, webhook | Ingest, build, deploy to GitHub Pages |
| [`preview.yml`](.github/workflows/preview.yml) | Pull request | Dry-run ingest + build check |

## Deployment

### GitHub Pages (default)

1. Enable GitHub Pages in the repo settings (source: GitHub Actions)
2. Push to `main` — the deploy workflow handles the rest

### Cloud Platform (containerised)

A `Dockerfile` can be added to serve the `out/` directory with nginx. The static export is fully compatible with container hosting.

## Licence

[MIT](LICENCE)
